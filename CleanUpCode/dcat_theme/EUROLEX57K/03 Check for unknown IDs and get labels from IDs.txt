import pandas as pd

# Load the first Excel file (containing rows "A" and "B")
file1 = '/content/GEMINI pro zero shot eurovoc corrected1.xlsx'
df1 = pd.read_excel(file1)

# Load the second Excel file with labels and IDs
file2 = '/content/label.xlsx'
df2 = pd.read_excel(file2)


df2.columns = df2.columns.str.strip()  # Removes any leading or trailing spaces
print("Column names in label-sample.xlsx:", df2.columns)


id_column = 'ID'
label_column = 'Label'


df2[id_column] = df2[id_column].astype(str)


id_to_label = dict(zip(df2[id_column], df2[label_column]))


def map_ids_to_labels(id_array):
    unknown_ids = []
    labels = []
    for id_ in id_array:
        label = id_to_label.get(str(id_), 'Unknown')
        labels.append(label)
        if label == 'Unknown':
            unknown_ids.append(str(id_))
    return labels, unknown_ids


rows_with_unknowns = []

df1['Original A'] = df1['A']  # Save original array A
df1['Original B'] = df1['B']  # Save original array B

def apply_mapping_and_check(row):
    labels_a, unknown_a = map_ids_to_labels(eval(row['A']))
    labels_b, unknown_b = map_ids_to_labels(eval(row['B']))

    # Collect unknown IDs
    unknown_ids = unknown_a + unknown_b

    # Check if there are unknown labels
    if unknown_ids:
        rows_with_unknowns.append((row.name, unknown_ids))  # Append the row index and unknown IDs

    return pd.Series([labels_a, labels_b])


df1[['Labels A', 'Labels B']] = df1.apply(apply_mapping_and_check, axis=1)


output_file = '/content/output.xlsx'
df1.to_excel(output_file, index=False)


if rows_with_unknowns:
    for row_num, unknown_ids in rows_with_unknowns:
        print(f"Row {row_num} has unknown label IDs: {unknown_ids}")
else:
    print("No 'Unknown' labels found.")

print(f"Labels and original arrays added and saved to {output_file}")

